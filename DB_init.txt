CREATE TABLE CLIENTI(
	EMAIL VARCHAR(50) PRIMARY KEY,
	NOME VARCHAR(50) NOT NULL,
	COGNOME VARCHAR(50) NOT NULL,
	ALLERGIE VARCHAR(200),
	DATIANAMNESTICI VARCHAR(200)
);

CREATE TABLE PRENOTAZIONI(
	CODICE INT AUTO_INCREMENT PRIMARY KEY,
	DATA DATE NOT NULL,
	ORARIO TIME NOT NULL,
	VACCINO VARCHAR(50) NOT NULL,
	EMAILCLIENTE VARCHAR(50) NOT NULL,
	
	CONSTRAINT FK_CLIENTE FOREIGN KEY (EMAILCLIENTE) REFERENCES CLIENTI(EMAIL)
);

CREATE TABLE FARMACIE(
	NOME VARCHAR(50) PRIMARY KEY,
	EMAIL VARCHAR(50) NOT NULL,
	VIA VARCHAR(50) NOT NULL,
	CIVICO VARCHAR(50) NOT NULL,
	CAP VARCHAR(50) NOT NULL,
	CITTA VARCHAR(50) NOT NULL
);

CREATE TABLE FARMACISTI(
	USERNAME VARCHAR(50) PRIMARY KEY,
	NOME VARCHAR(50) NOT NULL,
	COGNOME VARCHAR(50) NOT NULL,
	PASSWORD VARCHAR(50) NOT NULL,
	DIPENDENTE INT NOT NULL,
	FARMACIA VARCHAR(50) NOT NULL,
	
	CONSTRAINT FK_FARMACIA FOREIGN KEY (FARMACIA) REFERENCES FARMACIE(NOME)
);

CREATE TABLE CAPIFARMACIA(
	USERNAME VARCHAR(50) PRIMARY KEY,
	NOME VARCHAR(50) NOT NULL,
	COGNOME VARCHAR(50) NOT NULL,
	PASSWORD VARCHAR(50) NOT NULL
);

CREATE TABLE AFFERENZE(
	NOMEFARMACIA VARCHAR(50) PRIMARY KEY,
	USERNAME_CF VARCHAR(50) NOT NULL,
	
	CONSTRAINT FK_AFF_FARM FOREIGN KEY (NOMEFARMACIA) REFERENCES FARMACIE(NOME),
	CONSTRAINT FK_AFF_CF FOREIGN KEY (USERNAME_CF) REFERENCES CAPIFARMACIA(USERNAME)
);

CREATE TABLE VACCINAZIONI(
	CODICE INT AUTO_INCREMENT NOT NULL,
	NOMEFARMACIA VARCHAR(50) NOT NULL,
	ESITO VARCHAR(50),
	MOTIVAZIONE VARCHAR(50),
	CODICEPRENOTAZIONE INT NOT NULL,
	USERNAMEFARMACISTA VARCHAR(50),
	
	PRIMARY KEY (CODICE, NOMEFARMACIA),
	CONSTRAINT FK_PRENOTAZIONE FOREIGN KEY (CODICEPRENOTAZIONE) REFERENCES PRENOTAZIONI(CODICE),
	CONSTRAINT FK_EMAILFARMACISTA FOREIGN KEY (USERNAMEFARMACISTA) REFERENCES FARMACISTI(USERNAME),
	CONSTRAINT FK_NOMEFARMACIA FOREIGN KEY (NOMEFARMACIA) REFERENCES FARMACIE(NOME)	
);

CREATE TABLE TURNI(
	CODICE INT AUTO_INCREMENT PRIMARY KEY,
	DATA DATE NOT NULL,
	TIPO TINYINT NOT NULL,
	FARMACISTA VARCHAR(50) NOT NULL,
	
	CONSTRAINT FK_TURNI_FARMACISTI FOREIGN KEY (FARMACISTA) REFERENCES FARMACISTI(USERNAME),
	CONSTRAINT CHECK_TIPO CHECK (TIPO IN (0,1))

);

CREATE TABLE CARTELLESTATISTICHE(
	FARMACIA VARCHAR(50) PRIMARY KEY,
	NUMEROPRENOTAZIONIGIORNALIERE INT NOT NULL,
	NUMEROPRENOTAZIONISETTIMANALI INT NOT NULL,
	NUMEROPRENOTAZIONIMENSILI INT NOT NULL,
	NUMEROVACCINAZIONIGIORNALIERE INT NOT NULL,
	NUMEROVACCINAZIONISETTIMANALI INT NOT NULL,
	NUMEROVACCINAZIONIMENSILI INT NOT NULL,
	NUMEROANNULLAMENTIGIORNALIERI INT NOT NULL,
	NUMEROANNULLAMENTISETTIMANALI INT NOT NULL,
	NUMEROANNULLAMENTIMENSILI INT NOT NULL,
	
	CONSTRAINT FK_CART_FARM FOREIGN KEY (FARMACIA) REFERENCES FARMACIE(NOME)
);


INSERT INTO FARMACIE (NOME, EMAIL, VIA, CIVICO, CAP, CITTA) VALUES 
('Farmacia Centrale', 'centrale@example.com', 'Via Roma', '10', '00100', 'Roma'),
('Farmacia San Marco', 'sanmarco@example.com', 'Piazza San Marco', '15', '30100', 'Venezia'),
('Farmacia del Corso', 'corso@example.com', 'Corso Vittorio Emanuele', '22', '20100', 'Milano'),
('Farmacia Firenze', 'firenze@example.com', 'Via dei Medici', '5', '50100', 'Firenze'),
('Farmacia Napoli', 'napoli@example.com', 'Via Toledo', '40', '80100', 'Napoli'),
('Farmacia Torino', 'torino@example.com', 'Via Garibaldi', '8', '10100', 'Torino'),
('Farmacia Genova', 'genova@example.com', 'Via XX Settembre', '12', '16100', 'Genova'),
('Farmacia Bologna', 'bologna@example.com', 'Via Rizzoli', '20', '40100', 'Bologna'),
('Farmacia Palermo', 'palermo@example.com', 'Via Maqueda', '35', '90100', 'Palermo'),
('Farmacia Verona', 'verona@example.com', 'Via Mazzini', '25', '37100', 'Verona');

INSERT INTO CARTELLESTATISTICHE VALUES
('Farmacia Centrale', 0,0,0,0,0,0,0,0,0),
('Farmacia San Marco', 0,0,0,0,0,0,0,0,0),
('Farmacia del Corso', 0,0,0,0,0,0,0,0,0),
('Farmacia Firenze', 0,0,0,0,0,0,0,0,0),
('Farmacia Napoli', 0,0,0,0,0,0,0,0,0),
('Farmacia Torino', 0,0,0,0,0,0,0,0,0),
('Farmacia Genova', 0,0,0,0,0,0,0,0,0),
('Farmacia Bologna', 0,0,0,0,0,0,0,0,0),
('Farmacia Palermo', 0,0,0,0,0,0,0,0,0),
('Farmacia Verona', 0,0,0,0,0,0,0,0,0);

